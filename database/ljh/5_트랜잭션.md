# 21.01.14



## 주요 질문

#### 💡 [트랜잭션 설명해주세요.](#트랜잭션transaction)
   * DB 상태를 변화하는 흐름 단위이며 원자성, 일관성, 고립성, 지속성의 특징을 가지고 있습니다.

#### 💡 [로킹기법 설명해주세요](#로킹locking)
   * 트랜잭션이 동시에 여러개가 진행되면 갱신 손실, 연쇄 복귀 등 여러 문제가 발생할 수 있습니다. 로킹기법은 이 문제를 해결하기 위해 트랜잭션에 LOCK을 설정하여 LOCK이 존재하는 경우 트랜잭션이 진행되지 않도록 하는 기법입니다.

#### 💡 [로킹기법의 문제점은?](#로킹locking)
   * 트랜잭션들이 LOCK을 무기한 기다리는 교착 상태가 발생할 수 있습니다.

#### 💡 [교착상태의 빈도를 낮추는 방법은 뭐가 있나요?](교착상태deadlock)
  * 예방과 회피기법이 있습니다. 예방은 트랜잭션 전에 필요한 모든 데이터에 Lock을 미리 걸어주는 방법입니다. 하지만 데이터가 많으면 이 역시 데드락이 발생할 수 있습니다. 회피기법은 타임스탬프 기법을 적용하여 데이터를 시간 순서대로 제어하는 방법입니다.

<br/>

## ⭐ 개념 정리

### 트랜잭션(Transaction)

```
데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위
데이터베이스 시스템에서 복구 및 병행 수행 시 처리되는 작업의 논리적 단위
한꺼번에 수행되어야 할 일련의 연산
```

#### 트랜잭션의 연산과정

<img width="716" alt="스크린샷 2022-01-14 오후 3 02 05" src="https://user-images.githubusercontent.com/60912550/149459488-2c0a31fe-104b-4e21-9458-929c98b24001.png">

#### 트랜잭션의 상태

* 활동(Active) : 트랜잭션이 실행중인 상태
* 실패(Fail) : 트랜잭션 실행에 오류가 발생하여 중단된 상태
* 철회(Aborted) : 트랜잭션이 비정상적으로 종료되어 Rollback 연산을 수행한 상태
* 부분 완료(Partially Committed) : 트랜잭션의 마지막 연산까지 실행했지만, Commit 연산이 실행되기 직전의 상태
* 완료(Committed) : 트랜잭션이 성공적으로 종료되어 Commit 연산을 실행한 후의 상태

#### 트랜잭션의 특징

1. 트랜잭션은 데이터베이스 시스템에서 병행 제어 및 회복 작업 시 처리되는 작업의 논리적 단위이다.
2. 사용자가 시스템에 대한 서비스 요구 시 시스템이 응답하기 위한 상태 변환 과정의 작업단위이다.
3. 하나의 트랜잭션은 Commit 되거나 Rollback 된다.

#### 트랜잭션의 성질

* 트랜잭션이 성공적으로 처리되어 데이터베이스의 무결성과 일관성을 보장하려면 아래의 네 가지 특성을 꼭 만족해야 한다.
* 트랜잭션의 네 가지 특성을 영단어 첫글자를 따서 ACID 특성이라고 한다.

<img width="589" alt="스크린샷 2022-01-14 오후 2 54 02" src="https://user-images.githubusercontent.com/60912550/149458751-320e8e40-d697-4e3e-87d4-005f340480f3.png">

* 원자성(Atomicity)
  * 트랜잭션을 구성하는 연산들이 모두 정상적으로 실행되거나 아니면 전혀 실행되지 않아야 한다는 ALL-OR-NOTHING 방식을 의미한다.
  * 트랜잭션 내의 모든 명령은 반드시 완벽히 수행되어야 하며, 모두가 환벽히 수행되지 않고 어느 하나라도 오류가 발생할 경우 트랜잭션 전부가 취소되어야 한다.
* 일관성(Consistency)
  * 트랜잭션이 그 실행을 성공적으로 수행된 후에도 언제나 일관성 있는 데이터베이스 상태로 유지해야 한다.
  * 시스템이 가지고 있는 고정 요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야 한다.
* 독립성, 격리성(Isolation)
  * 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행 중에 다른 트랜잭션의 연산이 끼어들 수 없다.
  * 수행 중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.
* 영속성, 지속성(Durability)
  * 트랜잭션이 성공적으로 완료된 트랜잭션의 결과는 시스템이 고장 나더라도 영구적으로 반영되어야 한다.

#### 트랜잭션 연산 및 상태

* Commit
  * Commit 연산은 한 개의 논리적 단위(트랜잭션)에 대한 작업이 성공적으로 끝났고 데이터베이스가 다시 일관된 상태에 있을 때, 이 트랜잭션이 행한 갱신 연산이 완료된 것을 트랜잭션 관리자에게 알려주는 신호이다.
* Rollback
  * 하나의 트랜잭션 처리가 비정상적으로 종료되어 데이터베이스의 일관성을 깨뜨렸을 때, 이 트랜잭션의 일부가 정상적으로 처리되었더라도 트랜잭션의 원자성을 구현하기 위해 이 트랜잭션이 행한 모든 연산을 취소(Undo)하는 연산으로 Rollback시에는 해당 트랜잭션을 재시작하거나 폐기한다.

<br />

### 회복

* 외부/내부 장애로 데이터베이스가 일관성을 유지하지 못할 때 이를 유지하기 위한 방법
* 회복 연산자
  * REDO : 백업본으로 변경 후, 로그 기록에 남은 성공 데이터를 DB에 적용
  * UNDO : 변경된 데이터를 취소하고 예전 데이터로 복구

<br />

### 동시성 제어

* 여러 트랜잭션 간의 문제가 발생하지 않도록 트랜잭션의 실행 순서를 제어하는 방법

|       | T1    | T2    | 발생문제                   | 허용여부       |
| ----- | ----- | ----- | -------------------------- | -------------- |
| CASE1 | READ  | READ  | X                          | 허용           |
| CASE2 | READ  | WRITE | 오손읽기, 유령데이터 읽기  | 허용/불가 선택 |
| CASE3 | WRITE | WRITE | 갱신손실, 연쇄복구, 모순성 | 절대 불가      |

<br />

### 로킹(Locking)

* 동시성 제어 방법으로 트랜잭션에 LOCK을 설정하여 LOCK상태에서 다른 트랜잭션이 실행하지 못하도록 하는 기법
* 2단계 로킹
  * 확장 단계 : LOCK을 걸 수만 있음
  * 축소 단계 : UNLOCK만 가능
* 문제점 : 데이터가 많은 경우 교착상태에 빠질 수 있음

<br />

### 교착상태(DeadLock)

* 여러 트랜잭션이 실행되지 못하고 무기한 대기 중인 상태
* 해결 방법
  * 예방 기법 : 트랜잭션 시작 전, 필요한 데이터에 LOCK을 모두 걸어주는 기법. 필요한 데이터가 많은 경우 무쓸모
  * 회복 기법 : 자원 할당 시에 타임스탬프를 사용하여 시간 순서대로 제어하는 기법
